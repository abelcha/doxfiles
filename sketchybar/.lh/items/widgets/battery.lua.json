{
    "sourceFile": "items/widgets/battery.lua",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1720960132792,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1720960132792,
            "name": "Commit-0",
            "content": "local icons = require(\"icons\")\nlocal colors = require(\"colors\")\nlocal settings = require(\"settings\")\n\nlocal battery = sbar.add(\"item\", \"widgets.battery\", {\n  position = \"right\",\n  icon = {\n    font = {\n      style = settings.font.style_map[\"Regular\"],\n      size = 19.0,\n    }\n  },\n  label = { font = { family = settings.font.numbers } },\n  update_freq = 180,\n  popup = { align = \"center\" }\n})\n\nlocal remaining_time = sbar.add(\"item\", {\n  position = \"popup.\" .. battery.name,\n  icon = {\n    string = \"Time remaining:\",\n    width = 100,\n    align = \"left\"\n  },\n  label = {\n    string = \"??:??h\",\n    width = 100,\n    align = \"right\"\n  },\n})\n\n\nbattery:subscribe({\"routine\", \"power_source_change\", \"system_woke\"}, function()\n  sbar.exec(\"pmset -g batt\", function(batt_info)\n    local icon = \"!\"\n    local label = \"?\"\n\n    local found, _, charge = batt_info:find(\"(%d+)%%\")\n    if found then\n      charge = tonumber(charge)\n      label = charge .. \"%\"\n    end\n\n    local color = colors.green\n    local charging, _, _ = batt_info:find(\"AC Power\")\n\n    if charging then\n      icon = icons.battery.charging\n    else\n      if found and charge > 80 then\n        icon = icons.battery._100\n      elseif found and charge > 60 then\n        icon = icons.battery._75\n      elseif found and charge > 40 then\n        icon = icons.battery._50\n      elseif found and charge > 20 then\n        icon = icons.battery._25\n        color = colors.orange\n      else\n        icon = icons.battery._0\n        color = colors.red\n      end\n    end\n\n    local lead = \"\"\n    if found and charge < 10 then\n      lead = \"0\"\n    end\n\n    battery:set({\n      icon = {\n        string = icon,\n        color = color\n      },\n      label = { string = lead .. label },\n    })\n  end)\nend)\n\nbattery:subscribe(\"mouse.clicked\", function(env)\n  local drawing = battery:query().popup.drawing\n  battery:set( { popup = { drawing = \"toggle\" } })\n\n  if drawing == \"off\" then\n    sbar.exec(\"pmset -g batt\", function(batt_info)\n      local found, _, remaining = batt_info:find(\" (%d+:%d+) remaining\")\n      local label = found and remaining .. \"h\" or \"No estimate\"\n      remaining_time:set( { label = label })\n    end)\n  end\nend)\n\nsbar.add(\"bracket\", \"widgets.battery.bracket\", { battery.name }, {\n  background = { color = colors.bg1 }\n})\n\nsbar.add(\"item\", \"widgets.battery.padding\", {\n  position = \"right\",\n  width = settings.group_paddings\n})\n"
        }
    ]
}